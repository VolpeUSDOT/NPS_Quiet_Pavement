---
title: "Passby Noise Across Frequencies"
output: 
  html_document:
    self_contained: true
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: true
      smooth_scroll: false
---

<!-- saved from url=(0014)about:internet -->
<!-- This needs to be manually added to the second line of the html -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning=F, message=F)

library(tidyverse)
library(ggplot2)
library(grid)
require(gridExtra)
library(knitr)
library(kableExtra)
library(gtable)


codeloc = ifelse(file.exists('~/git/NPS_Quiet_Pavement'),
                 "~/git/NPS_Quiet_Pavement", "~/GitHub/NPS_Quiet_Pavement")

rootdir <- 'C:/Quiet_Pavement_Local'
knitr::opts_knit$set(root.dir = rootdir)

# Read in data prepared by Initial EDA Exploratory.ipynb, and drop the first column of rownames.
predictors <- read.csv(file.path(rootdir, 'MANOVA_Predictors.csv')); predictors <- predictors[-grep('^X$', names(predictors))]

# Format year
predictors$Year <- factor(predictors$Year, labels = c('2016', '2018', '2019')) # From 0, 1, 2

LZFeq <- read.csv(file.path(rootdir, 'MANOVA_LZFeq.csv')); LZFeq <- LZFeq[-grep('^X$', names(LZFeq))] 
LZFMax <- read.csv(file.path(rootdir, 'MANOVA_LZFMax.csv')); LZFMax <- LZFMax[-grep('^X$', names(LZFMax))]

# Bind predictors together with response values for easier manipulation
LZFeq <- data.frame(predictors, LZFeq)
LZFMax <- data.frame(predictors, LZFMax)

LZFeq <- LZFeq %>% mutate(macro_treatment = ifelse(Microsurfacing == 1, 'Microsurfacing', 'Chip.Seal')) 
LZFMax <- LZFMax %>% mutate(macro_treatment = ifelse(Microsurfacing == 1, 'Microsurfacing', 'Chip.Seal')) 

# Convert to long format. Organize by treatment, with four levels for the treatments in 2018. 
# LZFeq_l <- LZFeq %>% 
#   gather(key = yr_treatment, value, X3.8in.Chip.Seal:Type.III.Microsurfacing) %>%
#   mutate(macro_treatment = ifelse(Microsurfacing == 1, 'Microsurfacing', 'Chip.Seal')) %>%
#   select(-Chip.Seal, -Microsurfacing, -value)

# Manual loop. gather is not working as expected (grouping across years)
levs = c('X3.8in.Chip.Seal', 'X1.4in.Chip.Seal', 'Type.II.Microsurfacing', 'Type.III.Microsurfacing')
cols = names(LZFeq)[c(1:6, 11:48)]

LZFeq_l <- vector()
for(l in levs){
  ll = LZFeq[LZFeq[l] == 1, cols]
  ll$treatment = l
  LZFeq_l = rbind(LZFeq_l, ll)
  
}

# LZFMax_l <- LZFMax %>% 
#   gather(key = treatment, value, X3.8in.Chip.Seal:Type.III.Microsurfacing) %>%
#   mutate(macro_treatment = ifelse(Microsurfacing == 1, 'Microsurfacing', 'Chip.Seal')) %>%
#   select(-Chip.Seal, -Microsurfacing, -value)

cols = names(LZFMax)[c(1:6, 11:48)]

LZFMax_l <- vector()
for(l in levs){
  ll = LZFMax[LZFMax[l] == 1, cols]
  ll$treatment = l
  LZFMax_l = rbind(LZFMax_l, ll)
}

# Change treatment level for 2016 to baseline_chipseal
LZFeq_l <- LZFeq_l %>%
  mutate(treatment = ifelse(Year == '2016', 'baseline_chipseal', treatment))

LZFMax_l <- LZFMax_l %>%
  mutate(treatment = ifelse(Year == '2016', 'baseline_chipseal', treatment))


```

# Overview

Goal is to assess the noise measurements from passby measurements in 2018, where four quiet pavement treatments were applied to test areas: 1/4 in chip seal, 3/8 in chip seal, Type II microsurfacing, and Type III microsurfacing. 

There are eight sites, and four pavement treatments; each pavement treatment is replicated at two sites. Sound intensity was measured pre-treatment aand post-treatment.

In the original assessment, overall the Type II microsurfacing was found to reduce overall sound intensity sound from OBSI measuremnts from 99.2 dB on average to 97.6. Other treatments did not on average reduce sound levels.

This analysis focuses on the observational passby data, where vehicle type varies, and assessess the effects of speed and pavement temperature in addition to experimental treatments.

In the table below, SD_pavetemp is not applicable when the value is 0, because the same pavement temperature measurement was used throughout the trial.

```{r summary_vals}
Feq_summary <- LZFeq_l %>%
  group_by(Year, treatment) %>%  
  summarize(N_total = n(),
            N_autos = sum(vehtype == 1),
            Mean_speed = mean(speed),
            SD_speed = sd(speed),
            Mean_pavetemp = mean(pavetemp),
            SD_pavetemp = sd(pavetemp))

FMax_summary <- LZFMax_l %>%
  group_by(Year, treatment) %>%  
  summarize(N_total = n(),
            N_autos = sum(vehtype == 1),
            Mean_speed = mean(speed),
            SD_speed = sd(speed),
            Mean_pavetemp = mean(pavetemp),
            SD_pavetemp = sd(pavetemp))

kable(Feq_summary,
      caption = "Summary of passby data collected by year and treatment.",
      digits = 2) %>% 
  kable_styling(bootstrap_options = c("striped", "hover")) 

```
# MANOVA Analysis with LZFeq
```{r manova_1 with LZFeq}

LZFeq_l = filter(LZFeq_l, Year !="2019")

Feq.man.macro <- manova(cbind(X63.0,X80.0,X100.0,X125.0,X160.0,X200.0,X250.0,X315.0,X400.0,X500.0,
                        X630.0,X800.0,X1000.0,X1250.0,X1600.0,X2000.0,X2500.0,X3150.0,X4000.0,
                        X5000.0,X6300.0,X8000.0,X10000.0,X12500.0,X16000.0,X20000.0)~
                    macro_treatment + pavetemp * speed + Year, data = LZFeq_l)


Feq.man.micro <- manova(cbind(X63.0,X80.0,X100.0,X125.0,X160.0,X200.0,X250.0,X315.0,X400.0,X500.0,
                        X630.0,X800.0,X1000.0,X1250.0,X1600.0,X2000.0,X2500.0,X3150.0,X4000.0,
                        X5000.0,X6300.0,X8000.0,X10000.0,X12500.0,X16000.0,X20000.0)~
                      treatment + pavetemp * speed, data = LZFeq_l)


macro.coeff = coefficients(Feq.man.macro)
micro.coeff = coefficients(Feq.man.micro)
```

Using MANOVA, we see that there are strong effects of all the predictors on noise values across the frequencies. The first table is for overall effects of chip seal vs. microsurfacing, and the second table is for each of the four treatment levels.

```{r overall summary}
summary(Feq.man.macro)


summary(Feq.man.micro)
```


## Post-hoc ANOVAs by LZFeq Frequency

```{r manova_post_hoc with LZFeq1}
LZFeq_l = filter(LZFeq_l, Year != "2019")

LZFeq.aov.results = vector()
LZFeq.aov.stderr = vector()
frequencies = vector()

for (freq in names(LZFeq_l[16:41])){
  # freq = names(LZFeq_l[16])
  an.results = lm(LZFeq_l[[freq]] ~ treatment + pavetemp * speed, data = LZFeq_l)
  
  frequencies = rbind(frequencies, c(as.numeric(substr(freq, 2, nchar(freq)))))
  LZFeq.aov.results = rbind(LZFeq.aov.results, coef(an.results))
  LZFeq.aov.stderr = rbind(LZFeq.aov.stderr, coef(summary(an.results))[,"Std. Error"])
}
LZFeq.aov.results = data.frame(LZFeq.aov.results)
LZFeq.aov.results = cbind(LZFeq.aov.results, frequency = frequencies)

LZFeq.aov.stderr = data.frame(LZFeq.aov.stderr)
LZFeq.aov.stderr = cbind(LZFeq.aov.stderr, frequency = frequencies)
``` 
##Plotting ANOVA coefficient of change in sound intensity from pre-treatment for LZFeq
Response variables: treatment, pavement temperature, and speed

```{r fig.height = 20, fig.width = 15}
#Set colors for each point for 1/4 in chip seal
CS_1.4_col = c()
CS_1.4_col = ifelse(abs(LZFeq.aov.results$treatmentX1.4in.Chip.Seal)>LZFeq.aov.stderr$treatmentX1.4in.Chip.Seal,
       ifelse(LZFeq.aov.results$treatmentX1.4in.Chip.Seal<0, "blue", "red"),"gray")

#Plot LZFeq 1/4in Chip Seal
LZFeq_Chip.Seal.1.4 = ggplot()+
  geom_pointrange(data = LZFeq.aov.results,
                  aes(x = frequency,
                      y = treatmentX1.4in.Chip.Seal,
                      ymin = treatmentX1.4in.Chip.Seal - LZFeq.aov.stderr$treatmentX1.4in.Chip.Seal,
                      ymax =treatmentX1.4in.Chip.Seal + LZFeq.aov.stderr$treatmentX1.4in.Chip.Seal),
                  colour = CS_1.4_col,
                  size =1) +
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFeq ANOVA 1/4in Chip Seal Coefficients", 
       x = "Frequency (Hz)", 
       y = "Coefficent of Change in Sound \n Intensity from Pre-Treatment (dB)")  + 
  geom_hline(yintercept = 0)+
  ylim(-12,12)

#Set colors for each point in 3/8 in chip seal
CS_3.8_col = c()
CS_3.8_col = ifelse(abs(LZFeq.aov.results$treatmentX3.8in.Chip.Seal)>LZFeq.aov.stderr$treatmentX3.8in.Chip.Seal,
       ifelse(LZFeq.aov.results$treatmentX3.8in.Chip.Seal<0, "blue", "red"),"gray")

#Plot LZFeq 3/8 in chip seal
LZFeq_Chip.Seal.3.8 = ggplot()+
  geom_pointrange(data = LZFeq.aov.results, 
                  aes(x = frequency,
                      y = treatmentX3.8in.Chip.Seal,
                      ymin = treatmentX3.8in.Chip.Seal - LZFeq.aov.stderr$treatmentX3.8in.Chip.Seal,
                      ymax =treatmentX3.8in.Chip.Seal + LZFeq.aov.stderr$treatmentX3.8in.Chip.Seal),
                  colour = CS_3.8_col,
                  size = 1) +
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFeq ANOVA 3/8in Chip Seal Coefficients", 
       x = "Frequency (Hz)", 
       y = "Coefficent of Change in Sound \n Intensity from Pre-Treatment (dB)")  + 
  geom_hline(yintercept = 0)+
  ylim(-12,12)

#Set colors for each point in type II microsurfacing
TII_Micro_col = c()
TII_Micro_col = ifelse(abs(LZFeq.aov.results$treatmentType.II.Microsurfacing)>LZFeq.aov.stderr$treatmentType.II.Microsurfacing,
       ifelse(LZFeq.aov.results$treatmentType.II.Microsurfacing<0, "blue", "red"),"gray")

#Plot LZFeq type II microsurfacing
LZFeq_Microsurfacing.II = ggplot()+
  geom_pointrange(data = LZFeq.aov.results,
                  aes(x = frequency, 
                  y = treatmentType.II.Microsurfacing,
                  ymin=treatmentType.II.Microsurfacing - LZFeq.aov.stderr$treatmentType.II.Microsurfacing,
                  ymax=treatmentType.II.Microsurfacing + LZFeq.aov.stderr$treatmentType.II.Microsurfacing),
                  colour = TII_Micro_col,
                  size = 1) +
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFeq ANOVA Type II Microsurfacing Coefficients", 
       x = "Frequency (Hz)", 
       y = "Coefficent of Change in Sound \n Intensity from Pre-Treatment (dB)")  + 
  geom_hline(yintercept = 0)+
  ylim(-12,12)

#Set colors for each point in type III microsurfacing
TIII_Micro_col = c()
TIII_Micro_col = ifelse(abs(LZFeq.aov.results$treatmentType.III.Microsurfacing)>LZFeq.aov.stderr$treatmentType.III.Microsurfacing,
       ifelse(LZFeq.aov.results$treatmentType.III.Microsurfacing<0, "blue", "red"),"gray")

#Plot LZFeq Type III microsurfacing
LZFeq_Microsurfacing.III = ggplot()+
  geom_pointrange(data = LZFeq.aov.results,
                  aes(x = frequency, 
                  y = treatmentType.III.Microsurfacing,
                  ymin=treatmentType.III.Microsurfacing - LZFeq.aov.stderr$treatmentType.III.Microsurfacing,
                  ymax=treatmentType.III.Microsurfacing + LZFeq.aov.stderr$treatmentType.III.Microsurfacing),
                  colour = TIII_Micro_col,
                  size = 1) +
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFeq ANOVA Type III Microsurfacing Coefficients", 
       x = "Frequency (Hz)", 
       y = "Coefficent of Change in Sound \n Intensity from Pre-Treatment (dB)")  + 
  geom_hline(yintercept = 0)+
  ylim(-12,12)

#Arrange plots in grid
grid.arrange(LZFeq_Chip.Seal.1.4,LZFeq_Chip.Seal.3.8,LZFeq_Microsurfacing.II, LZFeq_Microsurfacing.III, nrow = 4)

```
```{r}

#ANOVA Model on Macro Treatment Types LZFeq
LZFeq_l = filter(LZFeq_l, Year != "2019")

LZFeq.aov.macro.results = vector()
LZFeq.aov.macro.stderr = vector()
frequencies = vector()

for (freq in names(LZFMax_l[16:41])){
  an.results = lm(LZFeq_l[[freq]] ~ -1+macro_treatment + pavetemp * speed+Year, data = LZFeq_l)
  frequencies = rbind(frequencies, c(as.numeric(substr(freq, 2, nchar(freq)))))
  LZFeq.aov.macro.results = rbind(LZFeq.aov.macro.results, coef(an.results))
  LZFeq.aov.macro.stderr = rbind(LZFeq.aov.macro.stderr, coef(summary(an.results))[,"Std. Error"])
}

LZFeq.aov.macro.results = data.frame(LZFeq.aov.macro.results)
LZFeq.aov.macro.results = cbind(LZFeq.aov.macro.results, frequency = frequencies)

LZFeq.aov.macro.stderr = data.frame(LZFeq.aov.macro.stderr)
LZFeq.aov.macro.stderr = cbind(LZFeq.aov.macro.stderr, frequency = frequencies)

```
##Plotting ANOVA coefficients of sound intensity for LZFeq
Predictors: Macro Treatment type, pavement temperature, speed, and year
```{r fig.height = 10, fig.width = 15}
#Plot Macro Treatment Type Results LZFeq
LZFeq_Chip.Seal = ggplot()+
  geom_pointrange(data = LZFeq.aov.macro.results,
                  aes(x=frequency,
                      y = macro_treatmentChip.Seal,
                      ymin =macro_treatmentChip.Seal - LZFeq.aov.macro.stderr$macro_treatmentChip.Seal,
                      ymax =macro_treatmentChip.Seal + LZFeq.aov.macro.stderr$macro_treatmentChip.Seal),
                  size = 1)+
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFeq ANOVA Chip Seal Coefficients",
       x = "Frequency (Hz)",
       y = "Coefficient of Sound Intensity (dB)")+
  ylim(-27,75)

LZFeq_Microsurfacing = ggplot()+
  geom_pointrange(data = LZFeq.aov.macro.results,
                  aes(x=frequency, 
                      y = macro_treatmentMicrosurfacing,
                      ymin =macro_treatmentMicrosurfacing - LZFeq.aov.macro.stderr$macro_treatmentMicrosurfacing,
                      ymax =macro_treatmentMicrosurfacing + LZFeq.aov.macro.stderr$macro_treatmentMicrosurfacing),
                  size = 1)+
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFeq ANOVA Microsurfacing Coefficients",
       x = "Frequency (Hz)",
       y = "Coefficient of Sound Intensity (dB)")+
  ylim(-27,75)

grid.arrange(LZFeq_Chip.Seal, LZFeq_Microsurfacing, nrow = 2)
```
#MANOVA Analysis with LZFMax
```{r manova with LZFMax_l}
LZFMax_l = filter(LZFMax_l, Year !="2019")

Feq.man.macro <- manova(cbind(X63.0,X80.0,X100.0,X125.0,X160.0,X200.0,X250.0,X315.0,X400.0,X500.0,
                        X630.0,X800.0,X1000.0,X1250.0,X1600.0,X2000.0,X2500.0,X3150.0,X4000.0,
                        X5000.0,X6300.0,X8000.0,X10000.0,X12500.0,X16000.0,X20000.0)~
                    macro_treatment+pavetemp*speed+Year, data = LZFMax_l)
summary(Feq.man.macro)

Feq.man.micro <- manova(cbind(X63.0,X80.0,X100.0,X125.0,X160.0,X200.0,X250.0,X315.0,X400.0,X500.0,
                        X630.0,X800.0,X1000.0,X1250.0,X1600.0,X2000.0,X2500.0,X3150.0,X4000.0,
                        X5000.0,X6300.0,X8000.0,X10000.0,X12500.0,X16000.0,X20000.0)~
                      treatment + pavetemp * speed, data = LZFMax_l)
summary(Feq.man.micro)

```
```{r manova_post_hoc with LZFMax_l}
LZFMax_l = filter(LZFMax_l, Year != "2019")

LZFMax.aov.results = vector()
LZFMax.aov.stderr = vector()
frequencies = vector()

for (freq in names(LZFMax_l[16:41])){
  an.results = lm(LZFMax_l[[freq]] ~ treatment + pavetemp * speed, data = LZFMax_l)
  frequencies = rbind(frequencies, c(as.numeric(substr(freq, 2, nchar(freq)))))
  LZFMax.aov.results = rbind(LZFMax.aov.results, coef(an.results))
  LZFMax.aov.stderr = rbind(LZFMax.aov.stderr, coef(summary(an.results))[,"Std. Error"])
}

LZFMax.aov.results = data.frame(LZFMax.aov.results)
LZFMax.aov.results = cbind(LZFMax.aov.results, frequency = frequencies)

LZFMax.aov.stderr = data.frame(LZFMax.aov.stderr)
LZFMax.aov.stderr = cbind(LZFMax.aov.stderr, frequency = frequencies)
```


##Plotting ANOVA coefficients of change in sound intensity from pretreatment for LZFMax
Predictors: Treatment type, pavement temperature, and speed
```{r fig.height = 20, fig.width = 15}

CS_1.4_col = c()
CS_1.4_col = ifelse(abs(LZFMax.aov.results$treatmentX1.4in.Chip.Seal)>
                          LZFMax.aov.stderr$treatmentX1.4in.Chip.Seal,
       ifelse(LZFMax.aov.results$treatmentX1.4in.Chip.Seal<0, "blue", "red"),"gray")

LZFMax_Chip.Seal.1.4 = ggplot()+
  geom_pointrange(data = LZFMax.aov.results, 
                  aes(x = frequency, 
                      y = treatmentX1.4in.Chip.Seal,
                      ymin = treatmentX1.4in.Chip.Seal - LZFMax.aov.stderr$treatmentX1.4in.Chip.Seal,
                      ymax =treatmentX1.4in.Chip.Seal + LZFMax.aov.stderr$treatmentX1.4in.Chip.Seal),
                  colour = CS_1.4_col,
                  size = 1) +
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFMax ANOVA 1/4in Chip Seal Coefficients", 
       x = "Frequency (Hz)", 
       y = "Coefficent of Change in Sound \n Intensity from Pre-Treatment (dB)")  + 
  geom_hline(yintercept = 0)+
  ylim(-12,12)

CS_3.8_col = c()
CS_3.8_col = ifelse(abs(LZFMax.aov.results$treatmentX3.8in.Chip.Seal)>
                          LZFMax.aov.stderr$treatmentX3.8in.Chip.Seal,
       ifelse(LZFMax.aov.results$treatmentX3.8in.Chip.Seal<0, "blue", "red"),"gray")

LZFMax_Chip.Seal.3.8 = ggplot()+
  geom_pointrange(data = LZFMax.aov.results, 
                  aes(x = frequency, 
                      y = treatmentX3.8in.Chip.Seal,
                      ymin = treatmentX3.8in.Chip.Seal - LZFMax.aov.stderr$treatmentX3.8in.Chip.Seal,
                      ymax =treatmentX3.8in.Chip.Seal + LZFMax.aov.stderr$treatmentX3.8in.Chip.Seal),
                  colour = CS_3.8_col,
                  size = 1) +
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFMax ANOVA 3/8in Chip Seal Coefficients", 
       x = "Frequency (Hz)", 
       y = "Coefficent of Change in Sound \n Intensity from Pre-Treatment (dB)")  + 
  geom_hline(yintercept = 0)+
  ylim(-12,12)

TII_Micro_col = c()
TII_Micro_col = ifelse(abs(LZFMax.aov.results$treatmentType.II.Microsurfacing)>
                          LZFMax.aov.stderr$treatmentType.II.Microsurfacing,
       ifelse(LZFMax.aov.results$treatmentType.II.Microsurfacing<0, "blue", "red"),"gray")

LZFMax_Microsurfacing.II = ggplot()+
  geom_pointrange(data = LZFMax.aov.results, 
                  aes(x = frequency, 
                      y = treatmentType.II.Microsurfacing,
                      ymin=treatmentType.II.Microsurfacing - LZFMax.aov.stderr$treatmentType.II.Microsurfacing,
                      ymax=treatmentType.II.Microsurfacing + LZFMax.aov.stderr$treatmentType.II.Microsurfacing),
                  colour = TII_Micro_col,
                  size = 1) +
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFMax ANOVA Type II Microsurfacing Coefficients", 
       x = "Frequency (Hz)", 
       y = "Coefficent of Change in Sound \n Intensity from Pre-Treatment (dB)")  + 
  geom_hline(yintercept = 0)+
  ylim(-12,12)

TIII_Micro_col = c()
TIII_Micro_col = ifelse(abs(LZFMax.aov.results$treatmentType.III.Microsurfacing)>
                          LZFMax.aov.stderr$treatmentType.III.Microsurfacing,
       ifelse(LZFMax.aov.results$treatmentType.III.Microsurfacing<0, "blue", "red"),"gray")

LZFMax_Microsurfacing.III = ggplot()+
  geom_pointrange(data = LZFMax.aov.results, 
                  aes(x = frequency, 
                      y = treatmentType.III.Microsurfacing,
                      ymin=treatmentType.III.Microsurfacing - LZFMax.aov.stderr$treatmentType.III.Microsurfacing,
                      ymax=treatmentType.III.Microsurfacing + LZFMax.aov.stderr$treatmentType.III.Microsurfacing),
                  colour = TIII_Micro_col,
                  size = 1) +
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFMax ANOVA Type III Microsurfacing Coefficients", 
       x = "Frequency (Hz)", 
       y = "Coefficent of Change in Sound \n Intensity from Pre-Treatment (dB)")  + 
  geom_hline(yintercept = 0)+
  ylim(-12,12)


grid.arrange(LZFMax_Chip.Seal.1.4,LZFMax_Chip.Seal.3.8,LZFMax_Microsurfacing.II, LZFMax_Microsurfacing.III, nrow = 4)

```

```{r fig.height = 20, fig.width = 15}
#ANOVA Model on Macro Treatment Types LZFMax
LZFMax_l = filter(LZFMax_l, Year != "2019")

LZFMax.aov.macro.results = vector()
LZFMax.aov.macro.stderr = vector()
frequencies = vector()

for (freq in names(LZFMax_l[16:41])){
  an.results = lm(LZFMax_l[[freq]] ~ -1+macro_treatment + pavetemp * speed+Year, data = LZFMax_l)
  frequencies = rbind(frequencies, c(as.numeric(substr(freq, 2, nchar(freq)))))
  LZFMax.aov.macro.results = rbind(LZFMax.aov.macro.results, coef(an.results))
  LZFMax.aov.macro.stderr = rbind(LZFMax.aov.macro.stderr, coef(summary(an.results))[,"Std. Error"])
}

LZFMax.aov.macro.results = data.frame(LZFMax.aov.macro.results)
LZFMax.aov.macro.results = cbind(LZFMax.aov.macro.results, frequency = frequencies)

LZFMax.aov.macro.stderr = data.frame(LZFMax.aov.macro.stderr)
LZFMax.aov.macro.stderr = cbind(LZFMax.aov.macro.stderr, frequency = frequencies)

```
##Plotting ANOVA coefficients of sound intensity for LZFMax
Predictors: Macro Treatment type, pavement temperature, speed, and year
```{r fig.height = 10, fig.width = 15}
#Plot Macro Treatment Type Results LZFMax
LZFMax_Chip.Seal = ggplot()+
  geom_pointrange(data = LZFMax.aov.macro.results, 
                  aes(x=frequency, 
                      y = macro_treatmentChip.Seal,
                      ymin =macro_treatmentChip.Seal - LZFMax.aov.macro.stderr$macro_treatmentChip.Seal,
                      ymax =macro_treatmentChip.Seal + LZFMax.aov.macro.stderr$macro_treatmentChip.Seal),
                  size = 1)+
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFMax ANOVA Chip Seal Coefficients",
       x = "Frequency (Hz)",
       y = "Coefficient of Sound Intensity (dB)")+
  ylim(-25,75)

LZFMax_Microsurfacing = ggplot()+
  geom_pointrange(data = LZFMax.aov.macro.results, 
                  aes(x=frequency, 
                      y = macro_treatmentMicrosurfacing,
                      ymin =macro_treatmentMicrosurfacing - LZFMax.aov.macro.stderr$macro_treatmentMicrosurfacing,
                      ymax =macro_treatmentMicrosurfacing + LZFMax.aov.macro.stderr$macro_treatmentMicrosurfacing),
                  size = 1)+
  theme_bw(base_line_size = 1,
           base_size = 20)+
  scale_x_log10()+
  labs(title = "LZFMax ANOVA Microsurfacing Coefficients",
       x = "Frequency (Hz)",
       y = "Coefficient of Sound Intensity (dB)")+
  ylim(-25,75)

grid.arrange(LZFMax_Chip.Seal, LZFMax_Microsurfacing, nrow = 2)
```